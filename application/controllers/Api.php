<?phpdefined('BASEPATH') OR exit('No direct script access allowed');class Api extends CI_Controller {		/**	 * Index Page for this controller.	 *	 * Maps to the following URL	 * 		http://example.com/index.php/welcome	 *	- or -	 * 		http://example.com/index.php/welcome/index	 *	- or -	 * Since this controller is set as the default controller in	 * config/routes.php, it's displayed at http://example.com/	 *	 * So any other public methods not prefixed with an underscore will	 * map to /index.php/welcome/<method_name>	 * @see http://codeigniter.com/user_guide/general/urls.html	 */	 	function __construct()    {		parent::__construct();		$this->usertype = '4';		$this->sections = array();		$sections = $this->Admin_mo->getwhere('sections',array('scactive'=>'1'));		if(!empty($sections))		{			foreach($sections as $section) { $this->sections[$section->scid] = $section->sccode; }		}				$this->langs = array();		$langs = $this->Admin_mo->getwhere('langs',array('lnactive'=>'1'));		if(!empty($langs))		{			foreach($langs as $lang) { $this->langs[$lang->lnid] = $lang->lncode; }		}	}		public function login()	{		//header('Content-Type: application/json');		//header('Content-Type: text/html; charset=utf-8');		//$_POST = '{"email":"aaaaa@aaaaa.com","password":"123123"}';		//$request = json_decode($_POST);		//$request = json_decode(file_get_contents('php://input'));		$response = array('data'=>'');		$request = $_POST;				if(isset($request['lang']) && in_array($request['lang'],$this->langs)) $this->lang->load($request['lang'], $request['lang']);	else $this->lang->load('en', 'en');				if(in_array('U',$this->sections))		{						if(isset($request) && !empty($request))			{				if(isset($request['username'],$request['password']))				{					if($request['username'] != '' && $request['password'] != '')					{																$data = $this->Admin_mo->getrow('users',array('username'=>str_replace(array('"',"'",' '), '',$request['username']),'uutid'=>$this->usertype));						if(isset($data) && !empty($data))						{							if(password_verify($request['password'], $data->upassword))							{								if($data->uactive == '1')								{									$response['message'] = lang('success');									$response['data'] = array('userid'=>$data->uid,'usercode'=>$data->uqcode,'name'=>$data->uname);									$response['code'] = '1';								}								else { $response['message'] = lang('user_not_active'); $response['code'] = '9'; }							}							else { $response['message'] = lang('wrong_password'); $response['code'] = '10'; }						}						else { $response['message'] = lang('user_not_exist'); $response['code'] = '0'; }					}					else { $response['message'] = lang('all_inputs_required'); $response['code'] = '6'; }				}				else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }			}			else { $response['message'] = lang('request_error'); $response['code'] = '3'; }		}		else { $response['message'] = lang('plugin_not_active'); $response['code'] = '2'; }				echo json_encode($response);	}		public function register()	{		$response = array('data'=>'');		$request = $_POST;				if(isset($request['lang']) && in_array($request['lang'],$this->langs)) $this->lang->load($request['lang'], $request['lang']);	else $this->lang->load('en', 'en');				if(in_array('U',$this->sections))		{			if(isset($request) && !empty($request))			{				if(isset($request['username'],$request['name'],$request['password'],$request['email'],$request['country'],$request['mobile']))				{					if($request['username'] != '' && $request['name'] != '' && $request['password'] != '' && filter_var($request['email'], FILTER_VALIDATE_EMAIL) && $request['country'] != '' && $request['mobile'] != '')					{						$username = $this->Admin_mo->exist('users',' where username like "'.str_replace(array('"',"'",' '), '',$request['username']).'"','');						$email = $this->Admin_mo->exist('users',' where uemail like "'.str_replace(array('"',"'",' '), '',$request['email']).'"','');						$mobile = $this->Admin_mo->exist('users',' where umobile like "'.str_replace(array('"',"'",' '), '',$request['mobile']).'"','');						if($username == 0 && $email == 0 && $mobile == 0)						{							$verificationCode = mt_rand(11111,99999);							$uqcode = mt_rand(11111,99999);							$set_arr = array('uutid'=>$this->usertype, 'uqcode'=>$uqcode, 'username'=>str_replace(array('"',"'"), '',$request['username']), 'uname'=>str_replace(array('"',"'"), '',$request['name']), 'uemail'=>str_replace(array('"',"'",' '), '',$request['email']), 'umobile'=>str_replace(array('"',"'",' '), '',$request['mobile']), 'upcid'=>$request['country'], 'upassword'=>password_hash($request['password'], PASSWORD_BCRYPT, array('cost'=>10)), 'ucode'=>$verificationCode, 'utime'=>time());							if(isset($_FILES['img']['error']) && $_FILES['img']['error'] == 0) $set_arr['uimage'] = $this->uploadimg('img',$this->config->item('users_folder'),$this->config->item('users_thumb_folder'),mt_rand());							$uid = $this->Admin_mo->set('users', $set_arr);							if(empty($uid))							{								$response['message'] = lang('somthing_wrong');								$response['code'] = '5';							}							else							{								$response['message'] = lang('success');								$response['verificationCode'] = $verificationCode;								$response['code'] = '1';							}						}						else						{							if($username != 0) $response['message'][] = lang('username_exist');							if($email != 0) $response['message'][] = lang('email_exist');							if($mobile != 0) $response['message'][] = lang('mobile_exist');							$response['code'] = '0';						}																						}					else { $response['message'] = lang('all_inputs_required'); $response['code'] = '6'; }				}				else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }			}			else { $response['message'] = lang('request_error'); $response['code'] = '3'; }		}		else { $response['message'] = lang('plugin_not_active'); $response['code'] = '2'; }				echo json_encode($response);	}			public function active()	{		$response = array('data'=>'');		$request = $_POST;				if(isset($request['lang']) && in_array($request['lang'],$this->langs)) $this->lang->load($request['lang'], $request['lang']);	else $this->lang->load('en', 'en');				if(in_array('U',$this->sections))		{			if(isset($request) && !empty($request))			{				if(isset($request['code'],$request['email']))				{					if($request['code'] != '' && filter_var($request['email'], FILTER_VALIDATE_EMAIL))					{						$data = $this->Admin_mo->getrow('users',array('uemail'=>$request['email'],'uutid'=>$this->usertype));						if(isset($data) && !empty($data))						{							if($data->uactive != '1')							{								if($data->ucode == str_replace(array('"',"'",' '), '',$request['code']))								{									if($this->Admin_mo->update('users', array('ucode'=>'','uactive'=>'1','uuid'=>0,'utime'=>time()), array('uid'=>$data->uid)))									{										$response['message'] = lang('success');										$response['data'] = array('userid'=>$data->uid,'usercode'=>$data->uqcode,'name'=>$data->uname);										$response['code'] = '1';									}									else									{										$response['message'] = lang('somthing_wrong');										$response['code'] = '5';									}															}								else {	$response['message'] = lang('wrong_code'); $response['code'] = '7'; }							}							else {	$response['message'] = lang('user_activated'); $response['code'] = '8'; }						}						else {	$response['message'] = lang('user_not_exist'); $response['code'] = '0'; }					}					else {	$response['message'] = lang('all_inputs_required'); $response['code'] = '6'; }				}				else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }			}			else { $response['message'] = lang('request_error'); $response['code'] = '3'; }		}		else { $response['message'] = lang('plugin_not_active'); $response['code'] = '2'; }				echo json_encode($response);	}		public function forgotpassword()	{		$response = array('data'=>'');		$request = $_POST;				if(isset($request['lang']) && in_array($request['lang'],$this->langs)) $this->lang->load($request['lang'], $request['lang']);	else $this->lang->load('en', 'en');				if(in_array('U',$this->sections))		{			if(isset($request) && !empty($request))			{				if(isset($request['email']) && filter_var($request['email'], FILTER_VALIDATE_EMAIL))				{					$email = $this->Admin_mo->exist('users',' where uutid = '.$this->usertype.' and uemail like "'.str_replace(array('"',"'",' '), '',$request['email']).'"','');					if($email != 0)					{						$newpassword = substr(str_shuffle('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+') , 0 , 9);						if($this->Admin_mo->update('users', array('upassword'=>password_hash($newpassword, PASSWORD_BCRYPT, array('cost'=>10)),'uuid'=>0,'utime'=>time()), array('uemail'=>$request['email'])))						{							$response['message'] = lang('success');							$response['data'] = lang('password').' : '.$newpassword;							$response['code'] = '1';						}						else						{							$response['message'] = lang('somthing_wrong');							$response['code'] = '5';						}					}					else					{						$response['message'] = lang('user_not_exist');						$response['code'] = '0';					}				}				else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }			}			else { $response['message'] = lang('request_error'); $response['code'] = '3'; }		}		else { $response['message'] = lang('plugin_not_active'); $response['code'] = '2'; }				echo json_encode($response);	}		public function languages()	{		$response = array('data'=>'');		$request = $_POST;				if(isset($request['lang']) && in_array($request['lang'],$this->langs)) $this->lang->load($request['lang'], $request['lang']);	else $this->lang->load('en', 'en');				if(in_array('LN',$this->sections))		{						$data = $this->Admin_mo->getjoinLeft('lnid as id,lntitle as title,lncode as code,lndir as dir','langs',array(),array('lnactive'=>'1'));			if(isset($data) && !empty($data))			{				$response['message'] = lang('data_exist');				$response['data'] = $data;				$response['code'] = '1';			}			else { $response['message'] = lang('no_data'); $response['code'] = '0'; }		}		else { $response['message'] = lang('plugin_not_active'); $response['code'] = '2'; }		echo json_encode($response);	}		public function places()	{		$response = array('data'=>'');		$request = $_POST;				if(isset($request['lang']) && in_array($request['lang'],$this->langs)) $this->lang->load($request['lang'], $request['lang']);	else $this->lang->load('en', 'en');				if(in_array('PC',$this->sections))		{						$data = $this->Admin_mo->getjoinLeft('pcid as id,pctitle as title,pcphone as phone,pccode as code','places',array(),array('pcactive'=>'1'));			if(isset($data) && !empty($data))			{				$response['message'] = lang('data_exist');				$response['images_folder'] = base_url().$this->config->item('places_folder');				$response['images_extension'] = '-32.png';				$response['data'] = $data;				$response['code'] = '1';			}			else { $response['message'] = lang('no_data'); $response['code'] = '0'; }		}		else { $response['message'] = lang('plugin_not_active'); $response['code'] = '2'; }		echo json_encode($response);	}	public function services()	{		$response = array('data'=>'');		$request = $_POST;				if(isset($request['lang']) && in_array($request['lang'],$this->langs)) $this->lang->load($request['lang'], $request['lang']);	else { $this->lang->load('en', 'en'); $request['lang'] = 'en'; }				if(in_array('TY',$this->sections))		{						if(isset($request) && !empty($request))			{				if(isset($request['lang']))				{										$data = $this->Admin_mo->getjoinLeft('types.tyid as id,ty_d.tytitle as title,ty_d.tydesc as desc','ty_d',array('types'=>'ty_d.dtyid = types.tyid'),array('types.tyactive'=>'1','ty_d.tylncode'=>$request['lang']));					if(isset($data) && !empty($data))					{						$response['message'] = lang('data_exist');						$response['data'] = $data;						$response['code'] = '1';					}					else { $response['message'] = lang('no_data'); $response['code'] = '0'; }				}				else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }			}			else { $response['message'] = lang('request_error'); $response['code'] = '3'; }		}		else { $response['message'] = lang('plugin_not_active'); $response['code'] = '2'; }		echo json_encode($response);	}		public function items()	{		$response = array('data'=>'');		$request = $_POST;				if(isset($request['lang']) && in_array($request['lang'],$this->langs)) $this->lang->load($request['lang'], $request['lang']);	else { $this->lang->load('en', 'en'); $request['lang'] = 'en'; }				if(in_array('TY',$this->sections))		{						if(isset($request) && !empty($request))			{				if(isset($request['lang']))				{					$where = array('items.iactive'=>'1','ty_d.tylncode'=>$request['lang'],'items.ito > '=>time());					if(isset($request['service']) && $request['service'] != '') $where['items.ityid'] = $request['service'];					$data = $this->Admin_mo->getjoinLeft('items.iid as id,items.ititle as title,items.iimg as img,items.iqrcode as qrcode,ty_d.tytitle as service_title','items',array('types'=>'items.ityid = types.tyid','ty_d'=>'types.tyid = ty_d.dtyid'),$where);					if(isset($data) && !empty($data))					{						$response['message'] = lang('data_exist');						$response['data'] = $data;						$response['logos_folder'] = base_url().$this->config->item('items_logos_folder');						$response['qrcodes_folder'] = base_url().$this->config->item('items_qrcodes_folder');						$response['code'] = '1';					}					else { $response['message'] = lang('no_data'); $response['code'] = '0'; }				}				else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }			}			else { $response['message'] = lang('request_error'); $response['code'] = '3'; }		}		else { $response['message'] = lang('plugin_not_active'); $response['code'] = '2'; }		echo json_encode($response);	}		public function offers()	{		$response = array('data'=>'');		$request = $_POST;				if(isset($request['lang']) && in_array($request['lang'],$this->langs)) $this->lang->load($request['lang'], $request['lang']);	else { $this->lang->load('en', 'en'); $request['lang'] = 'en'; }				if(in_array('OF',$this->sections))		{						if(isset($request) && !empty($request))			{				if(isset($request['lang']))				{					$where = array('items.iactive'=>'1','ty_d.tylncode'=>$request['lang'],'items.ito > '=>time(),'offers.ofto > '=>time());					if(isset($request['service']) && $request['service'] != '') $where['items.ityid'] = $request['service'];					if(isset($request['item']) && $request['item'] != '') $where['offers.ofiid'] = $request['item'];					$data = $this->Admin_mo->getjoinLeft('offers.ofid as id,offers.oftitle as title,offers.ofdesc as desc,offers.ofprice as price,offers.ofimg as img,items.ititle as item_title,items.iimg as item_img,items.iqrcode as qrcode,ty_d.tytitle as service_title','offers',array('items'=>'offers.ofiid = items.iid','types'=>'items.ityid = types.tyid','ty_d'=>'types.tyid = ty_d.dtyid'),$where);					if(isset($data) && !empty($data))					{						$response['message'] = lang('data_exist');						$response['data'] = $data;						$response['offers_folder'] = base_url().$this->config->item('offers_folder');						$response['logos_folder'] = base_url().$this->config->item('items_logos_folder');						$response['qrcodes_folder'] = base_url().$this->config->item('items_qrcodes_folder');						$response['code'] = '1';					}					else { $response['message'] = lang('no_data'); $response['code'] = '0'; }				}				else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }			}			else { $response['message'] = lang('request_error'); $response['code'] = '3'; }		}		else { $response['message'] = lang('plugin_not_active'); $response['code'] = '2'; }		echo json_encode($response);	}		public function paymentmethods()	{		$response = array('data'=>'');		$request = $_POST;				if(isset($request['lang']) && in_array($request['lang'],$this->langs)) $this->lang->load($request['lang'], $request['lang']);	else $this->lang->load('en', 'en');				if(in_array('CC',$this->sections))		{						$data = $this->Admin_mo->getjoinLeft('pmid as id,pmtitle as title','paymentmethods',array(),array('pmactive'=>'1'));			if(isset($data) && !empty($data))			{				$response['message'] = lang('data_exist');				$response['data'] = $data;				$response['code'] = '1';			}			else { $response['message'] = lang('no_data'); $response['code'] = '0'; }		}		else { $response['message'] = lang('plugin_not_active'); $response['code'] = '2'; }		echo json_encode($response);	}		public function ccards()	{		$response = array('data'=>'');		$request = $_POST;				if(isset($request['lang']) && in_array($request['lang'],$this->langs)) $this->lang->load($request['lang'], $request['lang']);	else $this->lang->load('en', 'en');				if(in_array('CC',$this->sections))		{						if(isset($request) && !empty($request))			{				if(isset($request['user']))				{					if($request['user'] != '')					{						$where = array('creditcards.cceid'=>$request['user']);						if(isset($request['method']) && $request['method'] != '') $where['creditcards.ccpmid'] = $request['method'];						$data = $this->Admin_mo->getjoinLeft('creditcards.ccid as id,creditcards.ccnumber as number,creditcards.ccexpire as expire,creditcards.cccvv as cvv,creditcards.ccsim as sim,creditcards.ccwallet as wallet,creditcards.ccbalance as balance,paymentmethods.pmtitle as payment_method','creditcards',array('paymentmethods'=>'creditcards.ccpmid = paymentmethods.pmid'),$where);						if(isset($data) && !empty($data))						{							$response['message'] = lang('data_exist');							$response['data'] = $data;							$response['code'] = '1';						}						else { $response['message'] = lang('no_data'); $response['code'] = '0'; }					}					else { $response['message'] = lang('all_inputs_required'); $response['code'] = '6'; }				}				else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }			}			else { $response['message'] = lang('request_error'); $response['code'] = '3'; }		}		else { $response['message'] = lang('plugin_not_active'); $response['code'] = '2'; }		echo json_encode($response);	}		public function transactions()	{		$response = array('data'=>'');		$request = $_POST;				if(isset($request['lang']) && in_array($request['lang'],$this->langs)) $this->lang->load($request['lang'], $request['lang']);	else $this->lang->load('en', 'en');				if(in_array('CC',$this->sections))		{						if(isset($request) && !empty($request))			{				if(isset($request['user']))				{					if($request['user'] != '')					{						$where = array('creditcards.cceid'=>$request['user']);						if(isset($request['from']) && $request['from'] != '') $where['transactions.ttfrom'] = $request['from'];						if(isset($request['to']) && $request['to'] != '') $where['transactions.ttto'] = $request['to'];						//$users = $this->Admin_mo->get('users'); if(!empty($users))	{	foreach($users as $user) { $myusers[$user->uid] = $user->uname; }	}						$ccards = $this->Admin_mo->get('creditcards'); if(!empty($ccards))	{	foreach($ccards as $ccard) { if($ccard->ccnumber) { $myccards[$ccard->ccid]['card'] = $ccard->ccnumber; $myccards[$ccard->ccid]['type'] = 'creditcard'; } elseif($ccard->ccsim) { $myccards[$ccard->ccid]['card'] = $ccard->ccsim;  $myccards[$ccard->ccid]['type'] = 'sim'; }elseif($ccard->ccwallet) { $myccards[$ccard->ccid]['card'] = $ccard->ccwallet;  $myccards[$ccard->ccid]['type'] = 'wallet'; } }	}						$preporders = $this->Admin_mo->getjoinLeft('transactions.ttid as id,transactions.ttprid as purchase,transactions.ttfrom as from,transactions.ttto as to,transactions.ttprice as price,transactions.ttaction as action,transactions.tttime as time','transactions',array('creditcards'=>'transactions.ttfrom = creditcards.ccid or transactions.ttto = creditcards.ccid'),$where);						if(isset($preporders) && !empty($preporders))						{							$myarray = array();							for($i=0;$i<count($preporders);$i++)							{								if(!in_array($preporders[$i]->id,$myarray))								{									$data[$i]['id'] = $preporders[$i]->id;									$data[$i]['purchase'] = $preporders[$i]->purchase;									if(isset($myccards[$preporders[$i]->from]['card'])) { $data[$i]['from'] = $myccards[$preporders[$i]->from]['card']; $data[$i]['from_type'] = lang($myccards[$preporders[$i]->from]['type']); } else { $data[$i]['from'] = 'me'; $data[$i]['from_type'] = 'me'; }									if(isset($myccards[$preporders[$i]->to]['card'])) { $data[$i]['to'] = $myccards[$preporders[$i]->to]['card']; $data[$i]['to_type'] = lang($myccards[$preporders[$i]->to]['type']); } else { $data[$i]['to'] = 'me'; $data[$i]['to_type'] = 'me'; }									$data[$i]['price'] = $preporders[$i]->price;									$data[$i]['action'] = $preporders[$i]->action;									$data[$i]['time'] = $preporders[$i]->time;								}								$myarray[$i] = $preporders[$i]->id;							}							$response['message'] = lang('data_exist');							$response['data'] = $data;							$response['code'] = '1';						}						else { $response['message'] = lang('no_data'); $response['code'] = '0'; }					}					else { $response['message'] = lang('all_inputs_required'); $response['code'] = '6'; }				}				else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }			}			else { $response['message'] = lang('request_error'); $response['code'] = '3'; }		}		else { $response['message'] = lang('plugin_not_active'); $response['code'] = '2'; }		echo json_encode($response);	}		public function purchases()	{		$response = array('data'=>'');		$request = $_POST;				if(isset($request['lang']) && in_array($request['lang'],$this->langs)) $this->lang->load($request['lang'], $request['lang']);	else $this->lang->load('en', 'en');				if(in_array('CC',$this->sections))		{						if(isset($request) && !empty($request))			{				if(isset($request['user']))				{					if($request['user'] != '')					{						$where = array('purchases.preid'=>$request['user']);						if(isset($request['from']) && $request['from'] != '') $where['purchases.prdate >='] = $request['from'];						if(isset($request['to']) && $request['to'] != '') $where['purchases.prdate <='] = $request['to'];						$data = $this->Admin_mo->getjoinLeft('purchases.prid as id,purchases.prprice as price,purchases.prdate as time,items.ititle as title','purchases',array('items'=>'purchases.priid = items.iid'),$where);						if(isset($data) && !empty($data))						{							$response['message'] = lang('data_exist');							$response['data'] = $data;							$response['code'] = '1';						}						else { $response['message'] = lang('no_data'); $response['code'] = '0'; }					}					else { $response['message'] = lang('all_inputs_required'); $response['code'] = '6'; }				}				else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }			}			else { $response['message'] = lang('request_error'); $response['code'] = '3'; }		}		else { $response['message'] = lang('plugin_not_active'); $response['code'] = '2'; }		echo json_encode($response);	}		public function purchaseset()	{		$response = array('data'=>'');		$request = $_POST;				if(isset($request['lang']) && in_array($request['lang'],$this->langs)) $this->lang->load($request['lang'], $request['lang']);	else $this->lang->load('en', 'en');				if(in_array('U',$this->sections))		{			if(isset($request) && !empty($request))			{				if(isset($request['user'],$request['item'],$request['price']))				{					if($request['user'] != '' && $request['item'] != '' && $request['price'] != '')					{						$set_arr = array('preid'=>$request['user'], 'pruid'=>$request['user'], 'priid'=>$request['item'], 'prprice'=>$request['price'], 'prdate'=>time(), 'prtime'=>time());						$prid = $this->Admin_mo->set('purchases', $set_arr);						if(empty($prid))						{							$response['message'] = lang('somthing_wrong');							$response['code'] = '5';						}						else						{															$response['message'] = lang('success');							$response['code'] = '1';						}					}					else { $response['message'] = lang('all_inputs_required'); $response['code'] = '6'; }				}				else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }			}			else { $response['message'] = lang('request_error'); $response['code'] = '3'; }		}		else { $response['message'] = lang('plugin_not_active'); $response['code'] = '2'; }				echo json_encode($response);	}		public function ccardset()	{		$response = array('data'=>'');		$request = $_POST;				if(isset($request['lang']) && in_array($request['lang'],$this->langs)) $this->lang->load($request['lang'], $request['lang']);	else $this->lang->load('en', 'en');				if(in_array('CC',$this->sections))		{			if(isset($request) && !empty($request))			{				if(isset($request['user'],$request['paymentmethod'],$request['balance'],$request['action']))				{					if($request['user'] != '' && $request['paymentmethod'] != '' && $request['balance'] != '' && $request['action'] != '')					{						if($request['action'] == 'number')						{							if(isset($request['number'],$request['expire'],$request['cvv']))							{								if($request['number'] != '' && $request['expire'] != '' && $request['cvv'] != '')								{									$data = $this->Admin_mo->getrow('creditcards',array('ccnumber'=>$request['number']));									if(isset($data) && !empty($data)) { $response['message'] = lang('number_exist'); $response['code'] = '0'; }									else									{										$set_arr = array('ccpmid'=>$request['paymentmethod'], 'cceid'=>$request['user'], 'ccnumber'=>$request['number'], 'ccexpire'=>$request['expire'], 'cccvv'=>$request['cvv'], 'ccbalance'=>$request['balance'], 'ccuid'=>$request['user'], 'cctime'=>time());										$ccid = $this->Admin_mo->set('creditcards', $set_arr);										if(empty($ccid))										{											$response['message'] = lang('somthing_wrong');											$response['code'] = '5';										}										else										{											$response['message'] = lang('success');											$response['code'] = '1';										}									}								}								else { $response['message'] = lang('all_inputs_required'); $response['code'] = '6'; }							}							else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }						}						elseif($request['action'] == 'sim')						{							if(isset($request['sim']))							{								if($request['sim'] != '')								{									$data = $this->Admin_mo->getrow('creditcards',array('ccsim'=>$request['sim']));									if(isset($data) && !empty($data)) { $response['message'] = lang('sim_exist'); $response['code'] = '0'; }									else									{										$set_arr = array('ccpmid'=>$request['paymentmethod'], 'cceid'=>$request['user'], 'ccsim'=>$request['sim'], 'ccbalance'=>$request['balance'], 'ccuid'=>$request['user'], 'cctime'=>time());										$ccid = $this->Admin_mo->set('creditcards', $set_arr);										if(empty($ccid))										{											$response['message'] = lang('somthing_wrong');											$response['code'] = '5';										}										else										{											$response['message'] = lang('success');											$response['code'] = '1';										}									}								}								else { $response['message'] = lang('all_inputs_required'); $response['code'] = '6'; }							}							else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }						}						elseif($request['action'] == 'wallet')						{							if(isset($request['wallet']))							{								if($request['wallet'] != '')								{									$data = $this->Admin_mo->getrow('creditcards',array('ccwallet'=>$request['wallet']));									if(isset($data) && !empty($data)) { $response['message'] = lang('wallet_exist'); $response['code'] = '0'; }									else									{										$set_arr = array('ccpmid'=>$request['paymentmethod'], 'cceid'=>$request['user'], 'ccwallet'=>$request['wallet'], 'ccbalance'=>$request['balance'], 'ccuid'=>$request['user'], 'cctime'=>time());										$ccid = $this->Admin_mo->set('creditcards', $set_arr);										if(empty($ccid))										{											$response['message'] = lang('somthing_wrong');											$response['code'] = '5';										}										else										{											$response['message'] = lang('success');											$response['code'] = '1';										}									}								}								else { $response['message'] = lang('all_inputs_required'); $response['code'] = '6'; }							}							else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }						}						else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }					}					else { $response['message'] = lang('all_inputs_required'); $response['code'] = '6'; }				}				else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }			}			else { $response['message'] = lang('request_error'); $response['code'] = '3'; }		}		else { $response['message'] = lang('plugin_not_active'); $response['code'] = '2'; }				echo json_encode($response);	}		public function ccardtransfer()	{		$response = array('data'=>'');		$request = $_POST;				if(isset($request['lang']) && in_array($request['lang'],$this->langs)) $this->lang->load($request['lang'], $request['lang']);	else $this->lang->load('en', 'en');				if(in_array('CC',$this->sections))		{			if(isset($request) && !empty($request))			{				if(isset($request['user'],$request['ccard'],$request['balance'],$request['action']))				{					if($request['user'] != '' && $request['ccard'] != '' && $request['balance'] != '' && $request['action'] != '')					{						$data = $this->Admin_mo->getrow('creditcards',array('ccid'=>$request['ccard'],'cceid'=>$request['user']));						if(isset($data) && !empty($data))						{							if($request['action'] == 'add')							{								if($this->Admin_mo->update('creditcards', array('ccbalance'=>$data->ccbalance + $request['balance'],'ccuid'=>$request['user'],'cctime'=>time()), array('ccid'=>$data->ccid)))								{									$this->Admin_mo->set('transactions', array('ttto'=>$data->ccid,'ttprice'=>$request['balance'],'ttaction'=>'add','tttime'=>time()));									$response['message'] = lang('success');									$response['code'] = '1';								}								else								{									$response['message'] = lang('somthing_wrong');									$response['code'] = '5';								}							}							elseif($request['action'] == 'transfer')							{								if(isset($request['user2'],$request['ccard2']))								{									if($request['user2'] != '' && $request['ccard2'] != '')									{										$data2 = $this->Admin_mo->getrow('creditcards',array('ccid'=>$request['ccard2'],'cceid'=>$request['user2']));										if(isset($data2) && !empty($data2))										{											if($data->ccbalance >= $request['balance'])											{												if($this->Admin_mo->update('creditcards', array('ccbalance'=>$data->ccbalance - $request['balance'],'ccuid'=>$request['user'],'cctime'=>time()), array('ccid'=>$data->ccid)) && $this->Admin_mo->update('creditcards', array('ccbalance'=>$data2->ccbalance + $request['balance'],'ccuid'=>$request['user'],'cctime'=>time()), array('ccid'=>$data2->ccid)))												{													$this->Admin_mo->set('transactions', array('ttfrom'=>$data->ccid,'ttto'=>$data2->ccid,'ttprice'=>$request['balance'],'ttaction'=>'transfer','tttime'=>time()));													$response['message'] = lang('success');													$response['code'] = '1';												}												else												{													$response['message'] = lang('somthing_wrong');													$response['code'] = '5';												}											}											else { $response['message'] = lang('balance_not_enough'); $response['code'] = '0'; }										}										else { $response['message'] = lang('no_data'); $response['code'] = '0'; }									}									else { $response['message'] = lang('all_inputs_required'); $response['code'] = '6'; }								}								else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }							}							elseif($request['action'] == 'purchase')							{								if(isset($request['user2'],$request['ccard2']))								{									if($request['user2'] != '' && $request['ccard2'] != '')									{										$data2 = $this->Admin_mo->getrow('creditcards',array('ccid'=>$request['ccard2'],'cceid'=>$request['user2']));										if(isset($data2) && !empty($data2))										{											if($data->ccbalance >= $request['balance'])											{												if($this->Admin_mo->update('creditcards', array('ccbalance'=>$data->ccbalance - $request['balance'],'ccuid'=>$request['user'],'cctime'=>time()), array('ccid'=>$data->ccid)) && $this->Admin_mo->update('creditcards', array('ccbalance'=>$data2->ccbalance + $request['balance'],'ccuid'=>$request['user'],'cctime'=>time()), array('ccid'=>$data2->ccid)))												{													$this->Admin_mo->set('transactions', array('ttprid'=>$request['purchase'],'ttfrom'=>$data->ccid,'ttto'=>$data2->ccid,'ttprice'=>$request['balance'],'ttaction'=>'purchase','tttime'=>time()));													$response['message'] = lang('success');													$response['code'] = '1';												}												else												{													$response['message'] = lang('somthing_wrong');													$response['code'] = '5';												}											}											else { $response['message'] = lang('balance_not_enough'); $response['code'] = '0'; }										}										else { $response['message'] = lang('no_data'); $response['code'] = '0'; }									}									else { $response['message'] = lang('all_inputs_required'); $response['code'] = '6'; }								}								else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }							}							else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }						}						else { $response['message'] = lang('no_data'); $response['code'] = '0'; }					}					else { $response['message'] = lang('all_inputs_required'); $response['code'] = '6'; }				}				else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }			}			else { $response['message'] = lang('request_error'); $response['code'] = '3'; }		}		else { $response['message'] = lang('plugin_not_active'); $response['code'] = '2'; }				echo json_encode($response);	}		public function settings()	{		$response = array('data'=>'');		$request = $_POST;				if(isset($request['lang']) && in_array($request['lang'],$this->langs)) $this->lang->load($request['lang'], $request['lang']);	else $this->lang->load('en', 'en');				if(in_array('U',$this->sections))		{			if(isset($request) && !empty($request))			{				if(isset($request['action']) && $request['action'] == 'show')				{					if(isset($request['user']))					{						if($request['user'] > 0)						{							$data = $this->Admin_mo->getrow('users',array('uid'=>$request['user']));							if(isset($data) && !empty($data))							{								$response['message'] = lang('data_exist');								if($this->config->item('users_thumb_folder')) $images_folder = base_url().$this->config->item('users_thumb_folder');								else $images_folder = base_url().$this->config->item('users_folder');								$response['data'] = array('username'=>$data->username,'name'=>$data->uname,'email'=>$data->uemail,'address'=>$data->uaddress,'mobile'=>$data->umobile,'lang'=>$data->ulang,'image'=>$images_folder.$data->uimage);								$response['code'] = '1';							}							else { $response['message'] = lang('no_data'); $response['code'] = '0'; }						}						else { $response['message'] = lang('all_inputs_required'); $response['code'] = '6'; }					}					else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }				}				elseif(isset($request['action']) && $request['action'] == 'edit')				{					if(isset($request['lang'],$request['user'],$request['username'],$request['name'],$request['email'],$request['mobile'],$request['address'],$request['password']))					{						if($request['user'] > 0 && $request['lang'] != '' && $request['username'] != '' && $request['name'] != '' && filter_var($request['email'], FILTER_VALIDATE_EMAIL) && $request['mobile'] != '')						{							$user = $this->Admin_mo->getrow('users',array('uid'=>$request['user']));							if(isset($user) && !empty($user))							{								$username = $this->Admin_mo->exist('users',' where uid != '.$request['user'].' and username like "'.str_replace(array('"',"'",' '), '',$request['username']).'"','');								$email = $this->Admin_mo->exist('users',' where uid != '.$request['user'].' and uemail like "'.str_replace(array('"',"'",' '), '',$request['email']).'"','');								$mobile = $this->Admin_mo->exist('users',' where uid != '.$request['user'].' and umobile like "'.str_replace(array('"',"'",' '), '',$request['mobile']).'"','');								if($username == 0 && $email == 0 && $mobile == 0)								{									$update_array = array('username'=>str_replace(array('"',"'"), '',$request['username']), 'uname'=>str_replace(array('"',"'"), '',$request['name']), 'uemail'=>str_replace(array('"',"'",' '), '',$request['email']), 'umobile'=>str_replace(array('"',"'",' '), '',$request['mobile']),'uaddress'=>$request['address'],'ulang'=>$request['lang'],'uuid'=>$request['user'],'utime'=>time());									if($request['password'] != '') $update_array['upassword'] = password_hash($request['password'], PASSWORD_BCRYPT, array('cost'=>10));									if(isset($_FILES['img']['error']) && $_FILES['img']['error'] == 0) { $update_array['uimage'] = $this->uploadimg('img',$this->config->item('users_folder'),$this->config->item('users_thumb_folder'),mt_rand()); if($update_array['uimage'] != '' && $user->uimage != '' && file_exists($this->config->item('users_folder').$user->uimage)) unlink($this->config->item('users_folder').$user->uimage); if($update_array['uimage'] != '' && $user->uimage != '' && file_exists($this->config->item('users_thumb_folder').$user->uimage)) unlink($this->config->item('users_thumb_folder').$user->uimage); }									if($this->Admin_mo->update('users', $update_array, array('uid'=>$request['user'])))									{										$response['message'] = lang('success');										$response['code'] = '1';									}									else									{										$response['message'] = lang('somthing_wrong');										$response['code'] = '5';									}								}								else								{									if($username != 0) $response['message'][] = lang('username_exist');									if($email != 0) $response['message'][] = lang('email_exist');									if($mobile != 0) $response['message'][] = lang('mobile_exist');									$response['code'] = '0';								}							}							else { $response['message'] = lang('user_not_exist'); $response['code'] = '0'; }						}						else { $response['message'] = lang('all_inputs_required'); $response['code'] = '6'; }					}					else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }				}				else { $response['message'] = lang('request_match_error'); $response['code'] = '4'; }			}			else { $response['message'] = lang('request_error'); $response['code'] = '3'; }		}		else { $response['message'] = lang('plugin_not_active'); $response['code'] = '2'; }		echo json_encode($response);	}		public function uploadimg($inputfilename,$image_director,$image_director_thumb,$newname)	{		$file_extn = pathinfo($_FILES[$inputfilename]['name'], PATHINFO_EXTENSION);		if(!is_dir($image_director)) $create_image_director = mkdir($image_director);		$name = $newname.".".$file_extn;		if(move_uploaded_file($_FILES[$inputfilename]["tmp_name"], $image_director.$name))		{			if($image_director_thumb != '')			{				$this->load->library('Resize');				$this->resize->construct($image_director.$name);				$this->resize->resizeImage(210, 210, 'exact');				$this->resize->saveImage($image_director_thumb.$name, 100);			}			return $name;		}		else return '';	}}