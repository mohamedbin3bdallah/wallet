<?phpdefined('BASEPATH') OR exit('No direct script access allowed');class Reports extends CI_Controller {	/**	 * Index Page for this controller.	 *	 * Maps to the following URL	 * 		http://example.com/index.php/welcome	 *	- or -	 * 		http://example.com/index.php/welcome/index	 *	- or -	 * Since this controller is set as the default controller in	 * config/routes.php, it's displayed at http://example.com/	 *	 * So any other public methods not prefixed with an underscore will	 * map to /index.php/welcome/<method_name>	 * @see http://codeigniter.com/user_guide/general/urls.html	 */	function __construct()    {		parent::__construct();		$this->mysystem = $this->Admin_mo->getrow('system',array('id'=>'1'));	    if(!$this->session->userdata('uid'))	    { 			redirect('home');	    }		else		{			$this->loginuser = $this->Admin_mo->getrowjoinLeftLimit('users.*,usertypes.utprivileges as privileges,langs.lndir as dir','users',array('usertypes'=>'users.uutid=usertypes.utid','langs'=>'users.ulang=langs.lncode'),array('users.uid'=>$this->session->userdata('uid')),'');			$this->sections = array();			$sections = $this->Admin_mo->getwhere('sections',array('scactive'=>'1'));			if(!empty($sections))			{				foreach($sections as $section) { $this->sections[$section->scid] = $section->sccode; }			}		}	}	public function index()	{		$data['system'] = $this->mysystem;		$this->lang->load($this->loginuser->ulang, $this->loginuser->ulang);		$this->config->set_item('language', $this->loginuser->ulang);		$data['users'] = $this->Admin_mo->getwhere('users',array('uutid'=>'3'));		$employees = $this->Admin_mo->get('users'); foreach($employees as $employee) { $data['employees'][$employee->uid] = $employee->username; }		$search = array();		if(set_value('user') != '') $search['items.ieid'] = set_value('user');		if(set_value('from') != '') $search['purchases.prdate >='] = strtotime(set_value('from'));		if(set_value('to') != '') $search['purchases.prdate <='] = strtotime(set_value('to'));		//$preporders = $this->Admin_mo->getjoinLeft('purchases.prid as prid,purchases.preid as preid,purchases.prprice as prprice,purchases.prdate as prdate,purchase_detailes.pdprice as pdprice,offers.oftitle as oftitle','purchases',array('purchase_detailes'=>'purchases.prid = purchase_detailes.pdprid','offers'=>'purchase_detailes.pdofid = offers.ofid','items'=>'offers.ofiid = items.iid'),array('items.ieid'=>$this->session->userdata('sid')));		//$preporders = $this->Admin_mo->getjoinLeft('purchases.prid as prid,purchases.preid as preid,purchases.prprice as prprice,purchases.prdate as prdate','purchases',array('items'=>'purchases.priid = items.iid'),array('items.ieid'=>$this->session->userdata('sid')));		$preporders = $this->Admin_mo->getjoinLeft('purchases.prid as prid,purchases.preid as preid,purchases.prprice as prprice,purchases.prdate as prdate','purchases',array('items'=>'purchases.priid = items.iid'),$search);		$data['reports_sum'] = 0;		$data['reports_count'] = count($preporders);		if(!empty($preporders))		{			for($i=0;$i<count($preporders);$i++)			{				$data['reports_sum'] = $data['reports_sum'] + $preporders[$i]->prprice;				//$data['orders'][$preporders[$i]->oid] = new stdClass();				$data['reports'][$preporders[$i]->prid]['prid'] = $preporders[$i]->prid;				$data['reports'][$preporders[$i]->prid]['preid'] = $preporders[$i]->preid;				$data['reports'][$preporders[$i]->prid]['prprice'] = $preporders[$i]->prprice;				$data['reports'][$preporders[$i]->prid]['prdate'] = $preporders[$i]->prdate;								//$data['reports'][$preporders[$i]->prid]['details'][$i]['pdprice'] = $preporders[$i]->pdprice;				//$data['reports'][$preporders[$i]->prid]['details'][$i]['oftitle'] = $preporders[$i]->oftitle;			}		}		$this->load->view('calenderdate');		$this->load->view('headers/reports',$data);		$this->load->view('sidemenu',$data);		$this->load->view('topmenu',$data);		$this->load->view('admin/reports',$data);		$this->load->view('footers/reports');		$this->load->view('messages');	}}