<?phpdefined('BASEPATH') OR exit('No direct script access allowed');class Ccards extends CI_Controller {	/**	 * Index Page for this controller.	 *	 * Maps to the following URL	 * 		http://example.com/index.php/welcome	 *	- or -	 * 		http://example.com/index.php/welcome/index	 *	- or -	 * Since this controller is set as the default controller in	 * config/routes.php, it's displayed at http://example.com/	 *	 * So any other public methods not prefixed with an underscore will	 * map to /index.php/welcome/<method_name>	 * @see http://codeigniter.com/user_guide/general/urls.html	 */	function __construct()    {		parent::__construct();		$this->mysystem = $this->Admin_mo->getrow('system',array('id'=>'1'));	    if(!$this->session->userdata('sid'))	    { 			redirect('service');	    }		else		{			$this->loginuser = $this->Admin_mo->getrowjoinLeftLimit('users.*,usertypes.utprivileges as privileges,langs.lndir as dir','users',array('usertypes'=>'users.uutid=usertypes.utid','langs'=>'users.ulang=langs.lncode'),array('users.uid'=>$this->session->userdata('sid')),'');						$this->item = $this->Admin_mo->getrow('items',array('ieid'=>$this->session->userdata('sid'), 'iactive'=>'1'));			$this->sections = array();			$sections = $this->Admin_mo->getwhere('sections',array('scactive'=>'1'));			if(!empty($sections))			{				foreach($sections as $section) { $this->sections[$section->scid] = $section->sccode; }			}		}	}	public function index()	{		if(strpos($this->loginuser->privileges, ',ccsee,') !== false && in_array('CC',$this->sections))		{		$data['title'] = 'creditcards';				$data['col_num'] = 6;		$data['system'] = $this->mysystem;		$this->lang->load($this->loginuser->ulang, $this->loginuser->ulang);		$this->config->set_item('language', $this->loginuser->ulang);		$employees = $this->Admin_mo->get('users'); foreach($employees as $employee) { $data['employees'][$employee->uid] = $employee->username; }		$data['ccards'] = $this->Admin_mo->getwhere('creditcards',array('cceid'=>$this->session->userdata('sid')));		$this->load->view('calenderdate');		//$data['users'] = $this->Admin_mo->rate('*','users',' where id <> 1');		$this->load->view('service/header',$data);		$this->load->view('service/sidemenu',$data);		$this->load->view('service/topmenu',$data);		$this->load->view('service/ccards',$data);		$this->load->view('service/footer',$data);		$this->load->view('messages');		}		else		{		$data['title'] = 'creditcards';		$data['admessage'] = 'youhavenoprivls';		$data['system'] = $this->mysystem;		$this->lang->load($this->loginuser->ulang, $this->loginuser->ulang);		$this->config->set_item('language', $this->loginuser->ulang);		$this->load->view('service/header',$data);		$this->load->view('service/sidemenu',$data);		$this->load->view('service/topmenu',$data);		$this->load->view('service/messages',$data);		$this->load->view('service/footer');		$this->load->view('messages');		}	}	public function add()	{		if(strpos($this->loginuser->privileges, ',ccadd,') !== false && in_array('CC',$this->sections))		{		$data['title'] = 'add_creditcard';		$data['system'] = $this->mysystem;		$this->lang->load($this->loginuser->ulang, $this->loginuser->ulang);		$this->config->set_item('language', $this->loginuser->ulang);		//$data['users'] = $this->Admin_mo->get('users');		$this->load->view('service/header-add',$data);		$this->load->view('service/sidemenu',$data);		$this->load->view('service/topmenu',$data);		$this->load->view('service/ccard-add',$data);		$this->load->view('service/footer-add');		$this->load->view('messages');		}		else		{		$data['title'] = 'add_creditcard';		$data['admessage'] = 'youhavenoprivls';		$data['system'] = $this->mysystem;		$this->lang->load($this->loginuser->ulang, $this->loginuser->ulang);		$this->config->set_item('language', $this->loginuser->ulang);		$this->load->view('service/header',$data);		$this->load->view('service/sidemenu',$data);		$this->load->view('service/topmenu',$data);		$this->load->view('service/messages',$data);		$this->load->view('service/footer');		$this->load->view('messages');		}	}		public function create()	{		if(strpos($this->loginuser->privileges, ',ccadd,') !== false && in_array('CC',$this->sections))		{		    $this->lang->load($this->loginuser->ulang, $this->loginuser->ulang);		$this->config->set_item('language', $this->loginuser->ulang);		$this->form_validation->set_error_delimiters('<div class="alert alert-danger alert-dismissible fade in" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">Ã—</span></button>', '</div>');		$this->form_validation->set_rules('number', 'lang:number' , 'trim|required|max_length[255]|is_unique[creditcards.ccnumber]');								$this->form_validation->set_rules('expire', 'lang:price' , 'trim|required');				$this->form_validation->set_rules('cvv', 'lang:cvv' , 'trim|required|max_length[3]');		if($this->form_validation->run() == FALSE)		{			$data['title'] = 'add_offer';			//$_SESSION['time'] = time(); $_SESSION['message'] = 'inputnotcorrect';			$data['system'] = $this->mysystem;			$this->load->view('service/header-add',$data);			$this->load->view('service/sidemenu',$data);			$this->load->view('service/topmenu',$data);			$this->load->view('service/ccard-add',$data);			$this->load->view('service/footer-add');			$this->load->view('messages');		}		else		{			$set_arr = array('ccuid'=>$this->session->userdata('sid'), 'cceid'=>$this->session->userdata('sid'), 'ccpmid'=>1, 'ccnumber'=>set_value('number'), 'ccexpire'=>set_value('expire'), 'cccvv'=>set_value('cvv'), 'ccactive'=>set_value('active'), 'cctime'=>time());			$ccid = $this->Admin_mo->set('creditcards', $set_arr);			if(empty($ccid))			{				$_SESSION['time'] = time(); $_SESSION['message'] = 'somthingwrong';				redirect('ccards/add', 'refresh');			}			else			{				$_SESSION['time'] = time(); $_SESSION['message'] = 'success';				redirect('ccards', 'refresh');			}						}		//redirect('ccards/add', 'refresh');		}		else		{		$data['title'] = 'add_creditcard';		$data['admessage'] = 'youhavenoprivls';		$data['system'] = $this->mysystem;		$this->lang->load($this->loginuser->ulang, $this->loginuser->ulang);		$this->config->set_item('language', $this->loginuser->ulang);		$this->load->view('service/header',$data);		$this->load->view('service/sidemenu',$data);		$this->load->view('service/topmenu',$data);		$this->load->view('service/messages',$data);		$this->load->view('service/footer');		$this->load->view('messages');		}	}		public function edit($id)	{		if(strpos($this->loginuser->privileges, ',ccedit,') !== false && in_array('CC',$this->sections))		{		$id = abs((int)($id));		$data['system'] = $this->mysystem;		$this->lang->load($this->loginuser->ulang, $this->loginuser->ulang);		$this->config->set_item('language', $this->loginuser->ulang);		$data['ccard'] = $this->Admin_mo->getrow('creditcards',array('ccid'=>$id));		if(!empty($data['ccard']))		{			$data['title'] = 'edit_creditcard';			$this->load->view('service/header-edit',$data);			$this->load->view('service/sidemenu',$data);			$this->load->view('service/topmenu',$data);			$this->load->view('service/ccard-edit',$data);			$this->load->view('service/footer-edit');			$this->load->view('messages');		}		else		{			$data['title'] = 'edit_creditcard';			$data['admessage'] = 'youhavenoprivls';			$this->load->view('service/header',$data);			$this->load->view('service/sidemenu',$data);			$this->load->view('service/topmenu',$data);			$this->load->view('service/messages',$data);			$this->load->view('service/footer');			$this->load->view('messages');		}		}		else		{		$data['title'] = 'edit_creditcard';		$data['admessage'] = 'youhavenoprivls';		$data['system'] = $this->mysystem;		$this->lang->load($this->loginuser->ulang, $this->loginuser->ulang);		$this->config->set_item('language', $this->loginuser->ulang);		$this->load->view('service/header',$data);		$this->load->view('service/sidemenu',$data);		$this->load->view('service/topmenu',$data);		$this->load->view('service/messages',$data);		$this->load->view('service/footer');		$this->load->view('messages');		}	}		public function editccard($id)	{		if(strpos($this->loginuser->privileges, ',ccedit,') !== false && in_array('CC',$this->sections))		{		$id = abs((int)($id));		if($id != '')		{		    $this->lang->load($this->loginuser->ulang, $this->loginuser->ulang);			$this->config->set_item('language', $this->loginuser->ulang);			$this->form_validation->set_error_delimiters('<div class="alert alert-danger alert-dismissible fade in" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">Ã—</span></button>', '</div>');			$this->form_validation->set_rules('number', 'lang:number' , 'trim|required|max_length[255]');									$this->form_validation->set_rules('expire', 'lang:price' , 'trim|required');					$this->form_validation->set_rules('cvv', 'lang:cvv' , 'trim|required|max_length[3]');			if($this->form_validation->run() == FALSE)			{				$data['title'] = 'edit_creditcard';				$data['system'] = $this->mysystem;				$data['ccard'] = $this->Admin_mo->getrow('creditcards',array('ccid'=>$id));				$this->load->view('service/header-edit',$data);				$this->load->view('service/sidemenu',$data);				$this->load->view('service/topmenu',$data);				$this->load->view('service/ccard-edit',$data);				$this->load->view('service/footer-edit');				$this->load->view('messages');			}			else			{				if($this->Admin_mo->exist('creditcards','where ccid <> '.$id.' and ccnumber like "'.set_value('number').'"',''))				{					$_SESSION['time'] = time(); $_SESSION['message'] = 'numberexist';					redirect('ccards/edit/'.$id, 'refresh');				}				else				{					$update_array = array('ccuid'=>$this->session->userdata('sid'), 'cceid'=>$this->session->userdata('sid'), 'ccpmid'=>1, 'ccnumber'=>set_value('number'), 'ccexpire'=>set_value('expire'), 'cccvv'=>set_value('cvv'), 'ccactive'=>set_value('active'), 'cctime'=>time());					if($this->Admin_mo->update('creditcards', $update_array, array('ccid'=>$id)))					{						$_SESSION['time'] = time(); $_SESSION['message'] = 'success';					}					else					{						$_SESSION['time'] = time(); $_SESSION['message'] = 'somthingwrong';					}					redirect('ccards', 'refresh');				}			}		}		else		{			$data['admessage'] = 'Not Saved';			$_SESSION['time'] = time(); $_SESSION['message'] = 'somthingwrong';			redirect('ccards', 'refresh');		}		//redirect('ccards', 'refresh');		}		else		{		$data['title'] = 'edit_creditcard';		$data['admessage'] = 'youhavenoprivls';		$data['system'] = $this->mysystem;		$this->lang->load($this->loginuser->ulang, $this->loginuser->ulang);		$this->config->set_item('language', $this->loginuser->ulang);		$this->load->view('service/header',$data);		$this->load->view('service/sidemenu',$data);		$this->load->view('service/topmenu',$data);		$this->load->view('service/messages',$data);		$this->load->view('service/footers');		$this->load->view('messages');		}	}	public function del($id)	{		$id = abs((int)($id));		if(strpos($this->loginuser->privileges, ',ccdelete,') !== false && in_array('CC',$this->sections))		{		$ccard = $this->Admin_mo->getrow('creditcards', array('ccid'=>$id));		if(!empty($ccard))		{			$this->Admin_mo->del('creditcards', array('ccid'=>$id));			$_SESSION['time'] = time(); $_SESSION['message'] = 'success';			redirect('ccards', 'refresh');		}		else		{			$data['title'] = 'creditcards';			$data['admessage'] = 'youhavenoprivls';			$data['system'] = $this->mysystem;			$this->lang->load($this->loginuser->ulang, $this->loginuser->ulang);			$this->config->set_item('language', $this->loginuser->ulang);			$this->load->view('service/header',$data);			$this->load->view('service/sidemenu',$data);			$this->load->view('service/topmenu',$data);			$this->load->view('service/messages',$data);			$this->load->view('service/footer');			$this->load->view('messages');		}		}		else		{		$data['title'] = 'creditcards';		$data['admessage'] = 'youhavenoprivls';		$data['system'] = $this->mysystem;		$this->lang->load($this->loginuser->ulang, $this->loginuser->ulang);		$this->config->set_item('language', $this->loginuser->ulang);		$this->load->view('service/header',$data);		$this->load->view('service/sidemenu',$data);		$this->load->view('service/topmenu',$data);		$this->load->view('service/messages',$data);		$this->load->view('service/footer');		$this->load->view('messages');		}	}}